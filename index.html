<script>
    const API_URL = "https://gpt-backend-kodi.onrender.com/chat"; 
    const HISTORY_URL = "https://gpt-backend-kodi.onrender.com/history";
    const ADMIN_CODE = "Admin123"; 

    // *** NOUVELLE LOGIQUE : GESTION DE L'ID UTILISATEUR ***
    function getUserId() {
        let userId = localStorage.getItem('chatUserId');
        if (!userId) {
            // Créer un ID unique simple (UUID réel serait mieux)
            userId = 'user-' + Date.now() + Math.floor(Math.random() * 9999);
            localStorage.setItem('chatUserId', userId);
        }
        return userId;
    }
    const currentUserId = getUserId(); 
    console.log("UserID pour cette session:", currentUserId);


    async function sendMessage() {
        // ... (début de sendMessage inchangé)

        const message = input.value.trim();
        if (message === "") return;

        // ... (affichage utilisateur et chargement inchangés)

        try {
            const response = await fetch(
                API_URL,
                {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ 
                        message: message,
                        // *** ENVOYER L'ID UTILISATEUR AU BACKEND ***
                        userId: currentUserId 
                    })
                }
            );
            // ... (suite de la logique inchangée)
        } catch (error) {
            // ... (gestion des erreurs inchangée)
        } finally {
            // ... (fin de la logique inchangée)
        }
    }
    
    // ... (checkAdminAccess et getChatHistory nécessiteraient des modifications complexes
    // pour récupérer l'historique de tous les utilisateurs; pour l'instant, nous 
    // les laissons pour récupérer l'historique de l'utilisateur actuel.)
    
    async function getChatHistory() {
        const historyOutput = document.getElementById("history-output");
        historyOutput.style.display = 'block'; 
        historyOutput.innerHTML = "Chargement de l'historique...";
        
        try {
            const response = await fetch(`${HISTORY_URL}?userId=${currentUserId}`); // *** ENVOI DE L'ID ***
            const data = await response.json();
            // ... (suite de la logique inchangée)
        } catch (error) {
             // ... (gestion des erreurs inchangée)
        }
    }

    // ... (suite du script inchangée)
</script>
